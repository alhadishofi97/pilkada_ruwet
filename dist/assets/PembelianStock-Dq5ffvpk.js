import{r as o,j as t,H as i}from"./index-xFPQpCZ-.js";import{a as c}from"./axios-BWYlR7gC.js";import{M as S}from"./index-Bh8HhtFf.js";import{S as y}from"./react-select.esm-zRfOOSia.js";import{X as P}from"./index.es-BQ0Wd5Uh.js";S.setAppElement("#root");const H=()=>{const[_,k]=o.useState([]),[s,d]=o.useState([{nama_barang:"",harga:"",qty:""}]),[j,h]=o.useState(!1),[b,v]=o.useState([]),[x,I]=o.useState(null);o.useState(null);const[B,w]=o.useState([]),[E,p]=o.useState(null);o.useState(!0);const[f,C]=o.useState("");o.useEffect(()=>{(async()=>{const n={headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}};try{const e=await c.get("https://backendapi.my.id/api/pembelian/all-detail-pembelian",n);e.data?w(Array.isArray(e.data)?e.data:[e.data]):p("Data is not in expected format")}catch{p("Failed to fetch data")}})()},[]),o.useEffect(()=>{const a=async()=>{const e={headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}},g=await c.get("https://backendapi.my.id/api/supplier/all-supplier",e);k(g.data.data.map(l=>({value:l.id_supplier,label:l.nama_supplier})))},r=async()=>{const e={headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}},g=await c.get("https://backendapi.my.id/api/barang/all_barang",e);v(g.data.data.map(l=>({value:l.id_barang,label:l.nama_barang})))};a(),r()},[]);const D=()=>{h(!0)},m=()=>{h(!1)},A=()=>{d([...s,{nama_barang:"",harga:"",qty:""}])},N=a=>{const r=s.filter((n,e)=>e!==a);d(r)},u=(a,r,n)=>{const e=[...s];e[a][r]=n,d(e)},T=async()=>{const r={headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`}};if(!x){p("Supplier harus dipilih");return}const n=s.map(e=>({id_nota:f,id_jenis_alur_barang:"1",id_supplier:x.value,id_barang:e.nama_barang,harga_beli:parseFloat(e.harga),quantity:parseInt(e.qty)}));try{const e=await c.post("https://backendapi.my.id/api/pembelian/create-pembelian",n,r);console.log("Response:",e.data),m()}catch(e){console.error("Error:",e),p("Failed to save data")}},q=[{name:"ID Pembelian",selector:a=>a.id_pembelian,sortable:!0},{name:"ID Nota",selector:a=>a.id_nota,sortable:!0},{name:"Nama Barang",selector:a=>a.nama_barang,sortable:!0},{name:"Harga Beli",selector:a=>a.harga_beli,sortable:!0},{name:"Quantity",selector:a=>a.quantity,sortable:!0},{name:"Nama Alur",selector:a=>a.nama_alur,sortable:!0,wrap:!0},{name:"Nama Supplier",selector:a=>a.nama_supplier,sortable:!0,wrap:!0},{name:"Tanggal",selector:a=>new Date(a.created_at).toLocaleDateString(),sortable:!0},{name:"No. Telp",selector:a=>a.no_telp,sortable:!0},{name:"Alamat",selector:a=>a.alamat,sortable:!0}],M=B.map(a=>({...a,nama_alur:a.nama_alur||"Unknown",nama_supplier:a.nama_supplier||"Unknown"}));return t.jsxs("div",{children:[t.jsx(i,{variant:"contained",marginBottom:"10px",onClick:D,children:"Tambah"}),t.jsx(P,{columns:q,data:M,pagination:!0}),t.jsxs(S,{isOpen:j,onRequestClose:m,contentLabel:"Tambah Pembelian",style:{content:{top:"50%",left:"50%",right:"auto",bottom:"auto",marginRight:"-50%",transform:"translate(-50%, -50%)",width:"600px",padding:"20px"}},children:[t.jsx("h2",{children:"Tambah Pembelian Stock"}),t.jsxs("form",{children:[t.jsxs("div",{children:[t.jsx("label",{children:"ID Nota:"}),t.jsx("input",{type:"text",placeholder:"Masukkan ID Nota",value:f,onChange:a=>C(a.target.value),style:{marginBottom:"10px",padding:"8px",width:"100%"}})]}),t.jsxs("div",{children:[t.jsx("label",{children:"Supplier:"}),t.jsx(y,{options:_,onChange:I,placeholder:"Pilih Supplier"})]}),t.jsxs("div",{children:[t.jsx("label",{children:"Barang:"}),s.map((a,r)=>t.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:"10px"},children:[t.jsx(y,{options:b,placeholder:"Pilih Barang",value:b.find(n=>n.value===s[r].nama_barang)||null,onChange:n=>u(r,"nama_barang",n?n.value:""),style:{marginRight:"10px",padding:"8px",flex:1}}),t.jsx("input",{type:"text",placeholder:"Harga",value:a.harga,onChange:n=>u(r,"harga",n.target.value),style:{marginLeft:"10px",marginRight:"10px",padding:"8px",flex:1}}),t.jsx("input",{type:"text",placeholder:"Qty",value:a.qty,onChange:n=>u(r,"qty",n.target.value),style:{marginRight:"10px",padding:"8px",flex:1}}),t.jsx(i,{onClick:()=>N(r),style:{color:"red"},children:"X"})]},r)),t.jsx(i,{onClick:A,style:{marginTop:"10px"},children:"+ Tambah"})]})]}),t.jsx(i,{onClick:T,style:{padding:"10px",fontSize:"16px"},children:"Simpan"}),t.jsx(i,{onClick:m,style:{padding:"10px",fontSize:"16px",marginLeft:"10px"},children:"Batal"})]})]})};export{H as default};
