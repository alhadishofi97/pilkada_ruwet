import{r,j as e,H as i}from"./index-xFPQpCZ-.js";import{a as l}from"./axios-BWYlR7gC.js";import{X as pa}from"./index.es-BQ0Wd5Uh.js";import{M as L}from"./index-Bh8HhtFf.js";import{d as ga}from"./Delete-Dq9YgP7t.js";import{S as m,A as k,D as ua,a as ha,b as ma,c as ka,d as _a}from"./Snackbar-6u2n4eKN.js";import{I as fa}from"./IconPencil-CDuvSLzG.js";L.setAppElement("#root");const Ba=()=>{const[A,x]=r.useState(!1),[O,g]=r.useState(!1),[P,_]=r.useState([]),[z,u]=r.useState([]),[H,I]=r.useState(!0),[F,T]=r.useState(null),[d,$]=r.useState(""),[N,J]=r.useState([]),[K,y]=r.useState(!1),[U,q]=r.useState([]),[h,Q]=r.useState(null),[o,j]=r.useState({part_no:"",nama_barang:"",id_kategori_barang:"",id_type_motor:"",jumlah_digudang:0,jumlah_ditoko:0,lokasi_rak:"",deskripsi:"",harga:"",delete_status:0,edited_by:""}),[p,C]=r.useState(null),[X,S]=r.useState(!1),[G,M]=r.useState(!1),[V,W]=r.useState(""),[Y,f]=r.useState(!1),[v,Z]=r.useState(0),[B,aa]=r.useState(null),[ea,D]=r.useState(!1),[ta,w]=r.useState(!1),R=a=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0}).format(a),ra=[{name:"Part No",selector:a=>a.part_no,sortable:!0,wrap:!0},{name:"Nama Barang",selector:a=>a.nama_barang,sortable:!0,wrap:!0},{name:"Jumlah di Gudang",selector:a=>a.jumlah_digudang,sortable:!0,wrap:!0},{name:"Pindah barang ke toko",selector:a=>a.jumlah_digudang,wrap:!0,format:a=>e.jsx("div",{children:e.jsx(i,{variant:"outlined",onClick:()=>da(a),children:a.jumlah_digudang})})},{name:"Jumlah di Toko",selector:a=>a.jumlah_ditoko,sortable:!0,wrap:!0},{name:"Lokasi Rak",selector:a=>a.lokasi_rak,sortable:!0},{name:"Deskripsi",selector:a=>a.deskripsi,sortable:!0,wrap:!0},{name:"Harga Jual",selector:a=>a.harga,sortable:!0,format:a=>R(a.harga_jual)},{name:"Harga Beli",selector:a=>a.harga_beli,sortable:!0,format:a=>R(a.harga_beli)},{name:"Kategori",selector:a=>{var t;return(t=a.kategori_barang)==null?void 0:t.nama_kategori_barang},sortable:!0},{name:"Tipe Motor",selector:a=>{var t;return(t=a.type_motor)==null?void 0:t.type_motor},sortable:!0},{name:"Action",selector:a=>"Action",width:"275px",sortable:!1,format:a=>e.jsxs("div",{children:[e.jsx(i,{variant:"outlined",onClick:()=>ia(a),style:{marginRight:"10px"},startIcon:e.jsx(fa,{}),children:"Edit"}),e.jsx(i,{variant:"outlined",onClick:()=>na(a),startIcon:e.jsx(ga,{}),children:"Delete"})]})}],na=a=>{Q(a),S(!0)},oa=async()=>{if(h)try{const t={headers:{Authorization:`Bearer ${localStorage.getItem("token")}`,"Content-Type":"application/json"}};if((await l.delete(`https://backendapi.my.id/api/barang/delete_barang/${h.id_barang}`,t)).data.status==="success"){M(!0);const n=await l.get("https://backendapi.my.id/api/barang/all_barang",t);_(n.data.data),u(n.data.data)}else alert("Failed to delete barang.")}catch(a){console.error("Error deleting barang:",a),alert("Failed to delete barang.")}finally{S(!1)}},b=()=>{x(!1),setOpen1(!1),g(!1)},sa=async()=>{if(!o.part_no||!o.nama_barang||!o.harga||!o.id_kategori_barang||!o.id_type_motor){g(!0),W("Please fill in all required fields");return}try{const a=localStorage.getItem("token");console.log(a);const t={headers:{Authorization:`Bearer ${a}`,"Content-Type":"application/json"}};if(p)if(console.log(o),(await l.put(`https://backendapi.my.id/api/barang/update_barang/${p.id_barang}`,o,t)).data.status==="success")x(!0);else throw new Error("Failed to update barang");else if((await l.post("https://backendapi.my.id/api/barang/create_barang",{...o,jumlah_digudang:0,jumlah_ditoko:0},t)).data.status==="success")x(!0);else throw new Error("Failed to create barang");const s=await l.get("https://backendapi.my.id/api/barang/all_barang",t);_(s.data.data),u(s.data.data),E()}catch(a){a.response&&a.response.status===409?g(!0):(console.error("Error saving data:",a),alert("Failed to save data"))}},ia=a=>{C(a),j({part_no:a.part_no,nama_barang:a.nama_barang,id_kategori_barang:a.id_kategori_barang,id_type_motor:a.id_type_motor,jumlah_digudang:a.jumlah_digudang,jumlah_ditoko:a.jumlah_ditoko,lokasi_rak:a.lokasi_rak,deskripsi:a.deskripsi,harga:a.harga||"",delete_status:a.delete_status,edited_by:a.edited_by}),y(!0)};r.useEffect(()=>{(async()=>{try{const s={headers:{Authorization:`Bearer ${localStorage.getItem("token")}`,"Content-Type":"application/json"}},n=await l.get("https://backendapi.my.id/api/barang/all_barang",s);n.data.status==="success"?(_(n.data.data),u(n.data.data)):T("Failed to fetch data"),I(!1)}catch{T("Failed to fetch data. Please check your network connection."),I(!1)}})()},[]),r.useEffect(()=>{const a=P.filter(t=>{var s;return t.part_no&&t.part_no.toLowerCase().includes(d.toLowerCase())||t.nama_barang&&t.nama_barang.toLowerCase().includes(d.toLowerCase())||t.lokasi_rak&&t.lokasi_rak.toLowerCase().includes(d.toLowerCase())||t.deskripsi&&t.deskripsi.toLowerCase().includes(d.toLowerCase())||String(t.harga).includes(d)||((s=t.kategori_barang)==null?void 0:s.nama_kategori_barang)&&t.kategori_barang.nama_kategori_barang.toLowerCase().includes(d.toLowerCase())});u(a)},[d,P]);const la=()=>{C(null),j({part_no:"",nama_barang:"",id_kategori_barang:"",id_type_motor:"",lokasi_rak:"",deskripsi:"",harga:"",delete_status:0,edited_by:""}),y(!0)},E=()=>{y(!1),C(null)},c=a=>{const{name:t,value:s}=a.target;j(n=>({...n,[t]:s}))};r.useEffect(()=>{(async()=>{try{const s={headers:{Authorization:`Bearer ${localStorage.getItem("token")}`,"Content-Type":"application/json"}},n=await l.get("https://backendapi.my.id/api/type-motor/all_motor",s);n.data.status==="success"?q(n.data.data):console.error("Failed to fetch types motor")}catch(t){console.error("Error fetching types motor:",t)}})()},[]),r.useEffect(()=>{(async()=>{try{const s={headers:{Authorization:`Bearer ${localStorage.getItem("token")}`,"Content-Type":"application/json"}},n=await l.get("https://backendapi.my.id/api/kategori-barang/all/kategori/barang",s);n.data.status==="success"?J(n.data.data):console.error("Failed to fetch categories")}catch(t){console.error("Error fetching categories:",t)}})()},[]);const da=a=>{aa(a),f(!0)},ca=async()=>{if(B){if(v>B.jumlah_digudang){w(!0);return}try{const t={headers:{Authorization:`Bearer ${localStorage.getItem("token")}`,"Content-Type":"application/json"}};if((await l.put(`https://backendapi.my.id/api/barang/update_stock/${B.id_barang}`,{jumlah_inputstok:v},t)).data.status==="success"){D(!0),f(!1);const n=await l.get("https://backendapi.my.id/api/barang/all_barang",t);_(n.data.data),u(n.data.data)}else alert("Failed to update stock")}catch(a){console.error("Error updating stock:",a),alert("Failed to update stock")}}};return H?e.jsx("p",{children:"Loading..."}):F?e.jsxs("p",{children:["Error: ",F]}):e.jsxs("div",{children:[e.jsx("h1",{children:"List Barang Supplier"}),e.jsx(i,{variant:"contained",onClick:()=>la(),style:{marginBottom:"20px"},children:p?"Update Barang":"Create Barang"}),e.jsx("div",{style:{marginBottom:"20px"},children:e.jsx("input",{type:"text",placeholder:"Cari berdasarkan Part No, Nama Barang, Lokasi Rak, Deskripsi, Harga, atau Kategori",value:d,onChange:a=>$(a.target.value),style:{width:"100%",padding:"10px",fontSize:"16px"}})}),e.jsx(pa,{columns:ra,data:z,pagination:!0,highlightOnHover:!0,responsive:!0,striped:!0}),e.jsxs(L,{isOpen:K,onRequestClose:E,contentLabel:"Create/Update Barang",style:{content:{top:"50%",left:"50%",right:"auto",bottom:"auto",marginRight:"-50%",transform:"translate(-50%, -50%)",width:"400px",padding:"20px"}},children:[e.jsx("h2",{children:p?"Update Barang":"Create Barang"}),e.jsxs("form",{children:[e.jsx("input",{name:"part_no",placeholder:"Part No",value:o.part_no,onChange:c,style:{width:"100%",marginBottom:"10px",padding:"8px"}}),e.jsx("input",{name:"nama_barang",placeholder:"Nama Barang",value:o.nama_barang,onChange:c,style:{width:"100%",marginBottom:"10px",padding:"8px"}}),e.jsxs("select",{name:"id_kategori_barang",value:o.id_kategori_barang,onChange:c,style:{width:"100%",marginBottom:"10px",padding:"8px"},children:[e.jsx("option",{value:"",children:"Pilih Kategori Barang"}),N.map(a=>e.jsx("option",{value:a.id_kategori_barang,children:a.nama_kategori_barang},a.id_kategori_barang))]}),e.jsxs("select",{name:"id_type_motor",value:o.id_type_motor,onChange:c,style:{width:"100%",marginBottom:"10px",padding:"8px"},children:[e.jsx("option",{value:"",children:"Pilih Tipe Motor"}),U.map(a=>e.jsx("option",{value:a.id_type_motor,children:a.type_motor},a.id_type_motor))]}),e.jsx("input",{name:"lokasi_rak",placeholder:"Lokasi Rak",value:o.lokasi_rak,onChange:c,style:{width:"100%",marginBottom:"10px",padding:"8px"}}),e.jsx("input",{name:"deskripsi",placeholder:"Deskripsi",value:o.deskripsi,onChange:c,style:{width:"100%",marginBottom:"10px",padding:"8px"}}),e.jsx("input",{name:"harga",placeholder:"Harga Jual",value:o.harga,onChange:c,style:{width:"100%",marginBottom:"10px",padding:"8px"}})]}),e.jsx(i,{variant:"contained",onClick:sa,style:{padding:"10px",fontSize:"16px"},children:p?"Update":"Save"}),e.jsx(i,{variant:"contained",color:"error",onClick:E,style:{padding:"10px",fontSize:"16px",marginLeft:"10px"},children:"Cancel"})]}),e.jsxs("div",{children:[e.jsx(m,{open:A,autoHideDuration:3e3,onClose:b,children:e.jsx(k,{onClose:b,severity:"success",variant:"filled",sx:{width:"100%"},children:p?"Successfully updated barang":"Successfully created barang"})}),e.jsx(m,{open:O,autoHideDuration:3e3,onClose:()=>g(!1),children:e.jsx(k,{onClose:()=>g(!1),severity:"error",variant:"filled",sx:{width:"100%"},children:V})})]}),e.jsxs(ua,{open:X,onClose:b,"aria-labelledby":"alert-dialog-description","aria-describedby":"alert-dialog-description",children:[e.jsx(ha,{id:"alert-dialog-title",children:"Confirm Delete"}),e.jsx(ma,{children:e.jsxs(ka,{id:"alert-dialog-description",children:["Are you sure you want to delete barang ",e.jsxs("strong",{children:['"',h==null?void 0:h.nama_barang,'"']}),"?"]})}),e.jsxs(_a,{children:[e.jsx(i,{onClick:()=>S(!1),color:"primary",children:"Cancel"}),e.jsx(i,{onClick:oa,color:"primary",autoFocus:!0,children:"Delete"})]})]}),e.jsx(m,{open:G,autoHideDuration:3e3,onClose:()=>M(!1),children:e.jsx(k,{onClose:b,severity:"success",variant:"filled",children:"Barang deletd successfully!"})}),e.jsxs(L,{isOpen:Y,onRequestClose:()=>f(!1),contentLabel:"Pindah Barang",style:{content:{top:"50%",left:"50%",right:"auto",bottom:"auto",marginRight:"-50%",transform:"translate(-50%, -50%)",width:"auto",padding:"20px"}},children:[e.jsx("h2",{children:"Pindah Barang ke Toko"}),e.jsx("form",{children:e.jsx("input",{type:"number",placeholder:"Jumlah Kuantitas",value:v,onChange:a=>Z(a.target.value),style:{width:"100%",marginBottom:"10px",padding:"8px"}})}),e.jsx(i,{variant:"contained",onClick:ca,style:{padding:"auto",fontSize:"auto"},children:"Pindah Barang"}),e.jsx(i,{variant:"contained",color:"error",onClick:()=>f(!1),style:{padding:"auto",fontSize:"auto",marginLeft:"10px"},children:"Cancel"})]}),e.jsx(m,{open:ea,autoHideDuration:3e3,onClose:()=>D(!1),children:e.jsx(k,{onClose:()=>D(!1),severity:"success",variant:"filled",children:"Stock toko updated successfully!"})}),e.jsx(m,{open:ta,autoHideDuration:3e3,onClose:()=>w(!1),children:e.jsx(k,{onClose:()=>w(!1),severity:"error",variant:"filled",children:"Jumlah pindah tidak boleh lebih besar dari stok di gudang."})})]})};export{Ba as default};
